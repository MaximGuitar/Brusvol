!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).MicroModal=t()}(this,(function(){"use strict";const e=(()=>{const e=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'];class t{constructor(e){let{targetModal:t,triggers:o=[],onShow:i=(()=>{}),onClose:n=(()=>{}),openTrigger:s="data-micromodal-trigger",closeTrigger:l="data-micromodal-close",openClass:a="is-open",disableScroll:r=!1,disableFocus:d=!1,awaitCloseAnimation:c=!1,awaitOpenAnimation:h=!1,debugMode:m=!1,id:g=""}=e;this.modal=document.getElementById(t),this.config={debugMode:m,disableScroll:r,openTrigger:s,closeTrigger:l,openClass:a,onShow:i,onClose:n,awaitCloseAnimation:c,awaitOpenAnimation:h,disableFocus:d},o.length>0&&this.registerTriggers(...o),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this),this.id=t;try{this.modal.classList.add("micromodal-initialized")}catch(e){throw"Could not initialize "+t}}registerTriggers(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];t.filter(Boolean).forEach(e=>{e.addEventListener("click",e=>this.showModal(e))})}showModal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.modal.classList.contains("is-open"))return void(this.config.debugMode&&console.warn("Modal already open"));i.push(this);let t=this.modal.parentNode;if(t.removeChild(this.modal),t.appendChild(this.modal),this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(this.config.openClass),this.scrollBehaviour("disable"),this.addEventListeners(),this.config.awaitOpenAnimation){const e=()=>{this.modal.removeEventListener("animationend",e,!1),this.setFocusToFirstNode()};this.modal.addEventListener("animationend",e,!1)}else this.setFocusToFirstNode();this.config.onShow(this.modal,this.activeElement,e)}closeModal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i=i.filter(e=>e.id!==this.id);const t=this.modal;if(this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.scrollBehaviour("enable"),this.activeElement&&this.activeElement.focus&&this.activeElement.focus(),this.config.onClose(this.modal,this.activeElement,e),this.config.awaitCloseAnimation){let e=this.config.openClass;this.modal.addEventListener("animationend",(function o(){t.classList.remove(e),t.removeEventListener("animationend",o,!1)}),!1)}else t.classList.remove(this.config.openClass)}closeModalById(e){this.modal=document.getElementById(e),this.modal&&this.closeModal()}scrollBehaviour(e){if(!this.config.disableScroll)return;const t=document.querySelector("body");switch(e){case"enable":Object.assign(t.style,{overflow:""});break;case"disable":Object.assign(t.style,{overflow:"hidden"})}}addEventListeners(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick)}removeEventListeners(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick)}onClick(e){e.target.hasAttribute(this.config.closeTrigger)&&this.closeModal(e)}onKeydown(e){9===e.keyCode&&this.retainFocus(e)}getFocusableNodes(){const t=this.modal.querySelectorAll(e);return Array(...t)}setFocusToFirstNode(){if(this.config.disableFocus)return;const e=this.getFocusableNodes();if(0===e.length)return;const t=e.filter(e=>!e.hasAttribute(this.config.closeTrigger));t.length>0&&t[0].focus(),0===t.length&&e[0].focus()}retainFocus(e){let t=this.getFocusableNodes();if(0!==t.length)if(t=t.filter(e=>null!==e.offsetParent),this.modal.contains(document.activeElement)){const o=t.indexOf(document.activeElement);e.shiftKey&&0===o&&(t[t.length-1].focus(),e.preventDefault()),!e.shiftKey&&t.length>0&&o===t.length-1&&(t[0].focus(),e.preventDefault())}else t[0].focus()}}let o=null,i=[];const n=e=>{if(!document.getElementById(e))return console.warn(`MicroModal: ❗Seems like you have missed %c'${e}'`,"background-color: #f8f9fa;color: #50596c;font-weight: bold;","ID somewhere in your code. Refer example below to resolve it."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",`<div class="modal" id="${e}"></div>`),!1},s=(e,t)=>{if((e=>{if(e.length<=0)console.warn("MicroModal: ❗Please specify at least one %c'micromodal-trigger'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>')})(e),!t)return!0;for(var o in t)n(o);return!0},l=e=>{if(27===e.keyCode&&i.length>0){let t=i[i.length-1];t&&t.closeModal(e)}};return{init:e=>{const i=Object.assign({},{openTrigger:"data-micromodal-trigger"},e),n=[...document.querySelectorAll(`[${i.openTrigger}]`)],a=((e,t)=>{const o=[];return e.forEach(e=>{const i=e.attributes[t].value;void 0===o[i]&&(o[i]=[]),o[i].push(e)}),o})(n,i.openTrigger);if(!0!==i.debugMode||!1!==s(n,a)){for(var r in a){let e=a[r];i.targetModal=r,i.triggers=[...e],o=new t(i)}document.addEventListener("keydown",l)}},show:(e,i)=>{const s=i||{};s.targetModal=e.replace(/^#/,""),!0===s.debugMode&&!1===n(e)||(o&&o.removeEventListeners(),o=new t(s),o.showModal())},close:(e,t)=>{let o={};if(e){e=e.replace(/^#/,""),o=i.filter(t=>t.id===e)[0]}else o=i[i.length-1];try{o.closeModal(t)}catch(t){console.warn("Cannot call close on Modal",e)}},initialized:e=>{var t;return e=e.replace(/^#/,""),null!==(t=document.getElementById(e))&&!!t.classList.contains("micromodal-initialized")}}})();return window.MicroModal=e,e}));
